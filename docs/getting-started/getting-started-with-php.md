# Getting started with PHP

Accessing tests on the 123test API consists of three main steps:

1. Retrieving access & session codes using the server side library
2. Retrieving the test using the client side library
3. Accessing reports

This document describes steps 1-3 using PHP in combination with the by 123test supported API library. The session & access codes that are generated can be used by the client side library to retrieve the tests and the reports associated to those tests.

To retrieve the codes you need an API key. This API key is used to encrypt and validate your request but is never sent to the API.

**Warning:** Never expose your API key on the client side or on any part of your application that is viewable by users. Your API key should remain secret. Only the one-time-use codes that are generated by following this tutorial can be used on the client side.


## Requirements

The following software is required when using our API with PHP:

* PHP 5.6
* mcrypt PHP extension
* cURL PHP extension

## Retrieving an API key

Your api key can be found on your credentials page on the API Backoffice.

## Obtaining the API library

We have created a small PHP library that handles the authentication with the API. This can be used to drastically increase development time. This library can be found in the SDK.

## Setting up the API library

The API library consists of a single PHP class that can be included on pages that need access to the API. The library
can be loaded using a single require statement:

```php
require_once('<path to library>/Its123Handler.php');
```

Using your API key and username, we can now create an instance of the handler:

```php
$handler = new Its123Handler('<username>', '<api key>');
```

Here, replace `<username>` with your username and `<api key>` with the api key associated to your account.

Optionally you can set the handler to debug mode to get more feedback in case of errors. *Note:* Do not use this in a production environment!

```php
//Handler with debug mode enabled
$handler = new Its123Handler('<username>', '<api key>', true);
```

## Retrieving session & access codes

Now the handler is loaded we can retrieve access codes for products. For this we need the unique product id.

```php
$handlerData = $handler->requestAccess('<product id>');
```

Here replace `<product id>` with the key of the product you wish to retrieve (see your credentials page for an overview of ids). By running the function
an encrypted request is done to the API to retrieve an access code for the product that is specified. These API requests are
done using *cURL*.

After calling this function `$handlerData` is filled with with an instance of `stdClass` with the following fields:

* `session`: A one-use-only access code that is bound to your API key. This session key gives access to the product you specified.
* `accessCode`: The access code that can be used to retrieve the result of the test (in most cases the report). This value is safe to show to users.
* `message`: Message describing the api result
* `status`: Status indicator in string format
* `status_id`: Status indicator in integer format

## Loading the test

After the access code is generated we are ready to retrieve the actual test. This is done client side using Javascript.

Start with including the API Javascript library on your page:

```html
<script src="//api.123test.com/its123api-js.js?v=1&callback=its123Initialize&reportFinished=its123ReportFinishedAjax"></script>
```

Note that the url contains two callback functions: `its123Initialize` for initialization and `its123ReportFinishedAjax` to run when the test is completed. These functions can be named differently, just make sure that you use the same names in the following steps.

First we define the initialization function:

```html
<script type="application/javascript">
    function its123Initialize()
    {
        var productOptions = {
            //The session code retrieved from the handler
            publicApiKey: '<?php echo $handlerData->session; ?>',
            //The id of the div tag where to apply the 123test product
            divIDProduct: '<id of html element>',
            //Class name of the div that contains the loading tag
            divClassLoadingComponent: '<class of loading element>',
        };

        its123.api.loadInstrument(productOptions, null);
    }
</script>
```

The main goal of this function is to define the configuration that is used by the Javascript library and to define the access code that is used for this request. The `publicApiKey` should be set to the session code you retrieved using the handler.
**Note:** Do *not* place your API key here, that should remain private.

The two other variables, `divIDProduct` and `divClassLoadingComponent`, are used to indicate which HTML elements are used for rendering the test. Set `divIDProduct` to the ID of the element where you want the test to show. `divClassLoadingComponent` can be used to show a loading message to users. Elements with this class are automatically shown and hidden when the API is loading.

## Loading the report

The second callback that the Javascript library uses defines the behaviour that is executed when the report is ready to be shown to the user; this is after all parts of the test have been completed. The function requests the report from the API and displays it to the user.

```html
<script type="application/javascript">
    function its123ReportFinishedAjax()
    {
        var productOptions = {
            //The id of the div tag where to apply the 123test product
            divReportID: '<id of html element>',
            //Class name of the div that contains the loading tag
            divClassLoadingComponent: '<class of loading element>'

        };

        its123.api.loadReport("standard", "<?php echo $handlerData->accessCode; ?>"  ,productOptions);
    }
</script>
```

Set `divIDReport` to the ID of the element where you want the report to show. `divClassLoadingComponent` can be used to show a loading message to users. Elements with this class are automatically shown and hidden when the API is loading.
